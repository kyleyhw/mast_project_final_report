\documentclass[floats,floatfix,showpacs,amssymb,prd,superscriptaddress,nofootinbib]{revtex4-2} % documentation at https://journals.aps.org/revtex/revtex-faq#u2
% \bibliographystyle{apsrev}
\bibliographystyle{mnras}

% \documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{hhline}
\usepackage{wrapfig}
\usepackage{ragged2e}
\raggedbottom
\usepackage{amsmath}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{hyperref}
\usepackage{xparse}
% \usepackage[backend=biber]{biblatex}
% \addbibresource{references.bib}
\usepackage{natbib}
\bibpunct{(}{)}{;}{a}{}{,}
% \setlength{\bibsep}{0pt plus 0.3ex}
\usepackage[toc,page]{appendix}
\usepackage{minted}
\usepackage{xcolor}
\definecolor{LightGray}{gray}{0.9}
\usepackage[left=2.54cm,right=2.54cm,top=2.54cm,bottom=2.54cm]{geometry}
\font\titlefont=cmr12 at 16pt
% inserting cover sheet: https://tex.stackexchange.com/questions/438775/how-to-insert-a-pdf-page-as-a-front-cover

% \newcommand{\PL}[1]{\textsf{\color{green!80!black}{\textsuperscript{PL}#1}}}
\newcommand{\code}{\texttt}
\newcommand{\red}{\textcolor{red}}
\newcommand{\blue}{\textcolor{blue}}
\newcommand{\lt}{\ensuremath <}
\newcommand{\gt}{\ensuremath >}

\setlength{\parindent}{20pt}
\renewcommand{\baselinestretch}{1.1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{figure}
%     \centering
%     \includegraphics[width=0.9\columnwidth]{images/Kyle_BLvsCR.png}
%     \caption{Recovered binary neutron star tidal parameters with and without binary Love relations, as compared to the common radius approximation.}
%     \label{fig:BLvsCR}
% \end{figure}

% \begin{figure}[H]
%      \centering
%      \begin{subfigure}[b]{0.9\textwidth}
%          \centering
%          \includegraphics[width=\textwidth]{images/ic_grids/initial_condition_grid_Om1.png}
%          \caption{Gravimeter}
%          \label{fig:IC_Om1}
%      \end{subfigure}
%      \hfill
%      \begin{subfigure}[b]{0.9\textwidth}
%          \centering
%          \includegraphics[width=\textwidth]{images/ic_grids/initial_condition_grid_Om5.png}
%          \caption{Alignment cross-hairs}
%          \label{fig:IC_Om5}
%      \end{subfigure}
%         \caption{}
%         \label{fig:apparatus}
% \end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{document}

% \title{{\titlefont Effects of variable cosmological parameters on
% \\the hydrogen 21cm cosmic dawn signal}\\{\small Supervised by Prof. Anastasia Fialkov and Jiten Dhandha}}
% % project title : Impact of structure formation and cosmology on the hydrogen 21-cm signal from cosmic dawn
% \date{\today}
% \author{Kyle Wong}
% \affiliation{Institute of Astronomy, University of Cambridge, Madingley Road, Cambridge, CB3 0HA, UK}

% % \begin{abstract}
% % Summarize the problem we are solving and our main findings.
% % \end{abstract}

% \maketitle
\newcommand{\reporttitle}{Variable cosmological parameters}
\newcommand{\reportsubtitle}{and their effects on the 21-cm cosmic dawn signal}
\newcommand{\reportauthor}{Kyle Wong}
\newcommand{\supervisorone}{Prof. Anastasia Fialkov}
\newcommand{\supervisortwo}{Jiten Dhandha}
\newcommand{\myabstract}{
21-cm cosmology is a promising probe of early-universe astrophysics, particularly in the cosmic eras known as the Dark Ages, Cosmic Dawn, and Epoch of Reionization. Astrophysical processes occurring during these periods is highly sensitive to the underlying cosmology. As such, the 21-cm signal also provides insight into the measurement cosmological parameters. While 21-cm simulations such as \code{21cmSPACE} focus predominantly on modelling the astrophysical processes prevalent during the early universe, the ability to vary the underlying cosmology in a 21-cm simulation will enable the study of the propagation of cosmological parameters onto the 21-cm signal. This study details a step in this direction: the implementation of variable cosmological parameters onto the generation of initial conditions (the initial mass overdensities $\delta_m$ and relative velocity between baryons and cold dark matter $v_{\text{bc}}$) in \code{21cmSPACE}, and the effects of changing some of these parameters is discussed. In particular, varying the mass density $\Omega_m$, the baryon density $\Omega_b$, and the hubble constant $h$ are shown to significantly affect the timing of cosmological eras, resulting in distortions of the 21-cm global signal and the 21-cm power spectrum.
}
\newcommand{\cid}{kyhw2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{document}

\input{titlepage}
\newpage

{\small \tableofcontents}
\newpage
\section{Introduction}
\subsection{21cm Cosmology}
Understanding the formation and evolution of cosmic structure remains one of the central goals of modern cosmology. While observations of the cosmic microwave background (CMB) and large-scale structure surveys have provided invaluable insights into the early and late-time universe, there exists a significant observational gap between the release of the CMB ($\sim$380,000 years after the Big Bang) and the emergence of the first luminous structures several hundred million years later. This intermediate period, encompassing the so-called Dark Ages, Cosmic Dawn, and the Epoch of Reionization (EoR), holds crucial information about the universe's thermal and ionization history, the formation of the first stars and galaxies, and the onset of feedback processes.

21-cm cosmology offers a unique and powerful tool to probe this otherwise inaccessible era. The signal arises from the hyperfine transition of neutral hydrogen (HI), which occurs when the relative spin orientation of the proton and electron flips from parallel to antiparallel, emitting or absorbing a photon with a rest-frame wavelength of 21 centimetres (corresponding to 1.42 GHz). Because neutral hydrogen was the most abundant element in the early universe, the 21-cm line provides a pervasive and potentially highly informative tracer of matter distribution over cosmic time.

As the universe expands, the 21-cm signal is redshifted, allowing observations at different frequencies to correspond to different epochs. By mapping the sky across frequency channels, it is, in principle, possible to construct a three-dimensional tomographic view of the intergalactic medium (IGM). This makes the 21-cm line a particularly sensitive probe for the thermal history of the IGM, the timing and topology of reionization, the formation of the first stars and black holes, and potentially, physics beyond the standard cosmological model, such as dark matter interactions or exotic energy injection.

The brightness temperature of the 21-cm signal, measured relative to the CMB, depends on the spin temperature of hydrogen, the neutral fraction, and the local density field. The differential brightness temperature can be written as \citep{Pritchard_Loeb_2012}

\begin{equation}
    \delta T_b (\nu) = 27 \ x_{HI} \ (1 + \delta_b) \left(1 - \frac{T_{\text{CMB}}}{T_s} \right) \left(\frac{1 + z}{10} \frac{0.15}{\Omega_m h^2} \right)^{1/2} \left( \frac{\Omega_b h^2}{0.023} \right) \text{mK}
    \label{eq:brightness_temperature}
\end{equation}

\noindent where $x_{HI}$ is the neutral hydrogen fraction, $\delta_b$ is the baryon over-density, $T_s$ is the spin temperature, $T_{\text{CMB}}$ is the CMB temperature at redshift $z$, and $\Omega_m$, $\Omega_b$ are the matter and baryon density parameters respectively.

Detecting this signal presents substantial technical challenges. The cosmological 21cm signal is typically five orders of magnitude fainter than galactic and extragalactic foregrounds, including synchrotron emission from our Galaxy. Additionally, instrumental systematics, ionospheric effects, and radio frequency interference (RFI) must be mitigated with extreme precision.

Despite these obstacles, a growing number of dedicated low-frequency radio interferometers—such as LOFAR, MWA, HERA, and the upcoming Square Kilometre Array (SKA)—are designed to detect and characterize the 21-cm signal from the early universe. These instruments aim to measure the power spectrum of 21-cm fluctuations, and eventually, perform direct imaging of the neutral IGM.

21-cm cosmology is poised to become a cornerstone of observational cosmology, potentially offering a detailed timeline of the universe's first billion years and enabling precision tests of fundamental physics in a previously uncharted epoch.

\newpage
\section{Theoretical Background}
\subsection{21-cm Signal Fundamentals}
\subsubsection{The hyperfine transition}
The 21-cm signal is the result of the hyperfine transition of atomic hydrogen, which, as both the most abundant and most basic element, is comprised of a single electron combined with a single proton. Due to the slight energy discrepancy between the spin-aligned state of this electron-proton pair and the spin-antialigned state, during this transition, atomic hydrogen can either emit or absorb a photon of wavelength 21 centimeters. The spin temperature $T_s$ is useful for studying the 21-cm emission line, and is given by \citep{Liu_Shaw_2020}

\begin{equation}
    \frac{n_1}{n_0} = 3 ~ \text{exp} \left( -\frac{h ~ \nu_{21}}{k_b ~ T_s} \right)
\end{equation}

\noindent where $n_1/n_0$ is the number of hydrogen atoms in the excited hyperfine (aligned) state over the number of hydrogen atoms in the ground hyperfine (anti-aligned) state, $h$ is Planck's constant, $k_b$ is Boltzmann's constant, and $\nu_{21} \approx 1420.406 ~\text{MHz}$ is the frequency of the 21-cm emission line in the rest frame. 

It is important to note that the spin temperature is not directly observed; rather, it is the difference between the Cosmic Microwave Background (CMB) temperature $T_{\text{CMB}}$ and the 21-cm spin temperature which is measured. Areas in which the 21-cm spin temperature is higher than the CMB temperature result in excess emission compared to what is expected from CMB emissions; on the contrary, when $T_s \lt T_{\text{CMB}}$, a photon deficit is measured instead \citep{Liu_Shaw_2020}.

The most important quantity when studying the 21-cm emission line is its brightness temberature $T_b$, which is defined in terms of $T_s$ by \citep{Furlanetto_2006}

\begin{equation}
    T_b (\hat{\textbf{r}}, \nu) = \left[1 - \text{exp}(-\tau_{21}(\hat{\textbf{r}}, z)) \right] \frac{T_s(\hat{\textbf{r}}, z) - T_{\text{CMB}} (z)}{1 + z}
\end{equation}

\noindent where $\hat{\textbf{r}}$ is a radial unit vector from the observer in the direction of observation, the doppler-shifted frequency of the observed signal $\nu$ is given by \citep{Liu_Shaw_2020}

\begin{equation}
    1 + z = \frac{\nu_{21}}{\nu}
\end{equation}

\noindent and $\tau_{21}$ is the 21-cm optical depth (i.e., how much 21-cm light is absorbed or scattered) of the interstellar medium, defined as \citep{Liu_Shaw_2020}

\begin{equation}
    \tau_{21} (\hat{\textbf{r}}, z) = \frac{3 \hbar c^3 A_{10}}{16 k_b \nu^2_{21}} \frac{x_{\mathrm{HI}} n_\mathrm{H}}{(1 + z) (dv_{\parallel} / dr_{\parallel}) T_s}
    \label{eq:optical_depth}
\end{equation}

\noindent with $v_\parallel$ the proper velocity along the line of sight $r_\parallel$, $x_{\mathrm{HI}}$ and $n_{\mathrm{H}}$ are the fraction and number density of neutral hydrogen atoms respectively, $\hbar$ is Planck's constant divided by $2\pi$, $c$ is the speed of light, and $A_{10} = 2.85 \times 10^{-15} \text{s}^{-1}$ is the spontaneous emission coefficient of the hyperfine transition, quantifying the probability that an atom in the aligned state will spontaneously decay into the anti-aligned state. 

\subsection{Cosmic history}
\subsubsection{Dark Ages (No Starlight, $\mathbf{z \sim 1100-30}$)}
After recombination (the decoupling of CMB photons at $z \approx 1100$), the universe entered the Dark Ages, before any stars or galaxies existed. During this era, neutral hydrogen filled the intergalactic medium (IGM) and the 21 cm spin temperature ($T_s$) was governed by collisions with the cooling gas. Initially, Compton scattering off residual electrons kept the gas (and thus $T_s$) thermally coupled to the CMB down to $z\sim300$. Once this coupling broke, the gas cooled adiabatically faster than the CMB (${T_{\rm gas}}\propto(1+z)^2$). With collisions still effective at high densities, $T_s$ followed the gas temperature, dropping below the CMB temperature $T_{\text{CMB}}$ and producing a 21 cm absorption signal against the CMB. By $z\sim30$, however, the expanding gas became too diffuse for collisions to maintain coupling, so $T_s$ drifted back toward $T_{\text{CMB}}$, causing the 21 cm signal to vanish (zero contrast). Throughout the Dark Ages, in the absence of astrophysical sources, the 21 cm fluctuations directly trace primordial density perturbations in the neutral hydrogen (assuming HI traces the underlying matter). This makes the Dark Ages 21 cm signal a pristine probe of fundamental cosmology (e.g. the matter power spectrum on small scales), potentially constraining inflationary parameters or dark matter properties.
% (Loeb \& Zaldarriaga 2004; Masui \& Pen 2010; Muñoz et al. 2015)
In principle, observations of 21 cm from these ultra-high redshifts could shed light on new physics beyond the CMB.
% (Scott \& Rees 1990; Furlanetto et al. 2019)
In practice, detecting the Dark Ages signal is extraordinarily challenging: the relevant frequencies $\nu \lesssim 50$ MHz are heavily contaminated by bright Galactic foregrounds and blocked by the ionosphere on Earth. As a result, this epoch remains unexplored observationally, reserved for futuristic instruments (perhaps a lunar radio array) capable of overcoming these hurdles (Tegmark \& Zaldarriaga 2009).
\subsubsection{Cosmic Dawn (First Light, $\mathbf{z \sim 30-15}$)}
The Cosmic Dawn began once the first generation of stars and galaxies formed (likely in halos of mass $\gtrsim10^5$–$10^6,M_\odot$). Lyman-$\alpha$ photons from these early luminous sources triggered the Wouthuysen-Field effect \citep{Wouthuysen_1952, Field_1958}: Ly$\alpha$ absorption and re-emission cycles flip the hydrogen spin, coupling $T_s$ to the kinetic temperature of the cold IGM gas. As soon as a pervasive Ly$\alpha$ background developed, $T_s$ was driven below $T_{\text{CMB}}$ again, inducing a deep 21 cm absorption signal. This expected global absorption trough is the first prominent feature of the 21 cm history. %(Madau et al. 1997; Pritchard \& Loeb 2012)
Its depth and timing are sensitive to the onset of star formation and the Ly$\alpha$ production efficiency of the earliest galaxies. As cosmic dawn progresses, new radiative processes come into play: X-rays from the first X-ray binaries, mini-quasars, or hot interstellar gas begin to heat the IGM. These high-energy photons penetrate the IGM and photo-ionize atoms, depositing energy as heat via fast photo-electrons colliding with the gas. Gradually, X-ray heating raises the gas temperature. When the gas (and hence $T_s$) is heated above the CMB temperature, the 21 cm signal transitions from absorption to emission. The precise redshift at which this turning point occurs depends on the total X-ray luminosity of early sources and the hardness of their spectra (Fialkov et al. 2014; Mirocha et al. 2017). Throughout cosmic dawn, the 21 cm brightness is highly inhomogeneous: regions near early galaxies see strong Ly$\alpha$ flux and early heating, while faraway regions remain colder and unheated. This patchiness encodes rich astrophysical information. Measuring the 21 cm signal (globally or via its power spectrum) during cosmic dawn would allow us to infer properties of the first sources: for example, the minimum halo mass able to host star formation, the stellar initial mass function, and the X-ray production efficiency.
% (Pober et al. 2013a; Mesinger et al. 2014; Fialkov et al. 2017)
In essence, 21 cm observations during cosmic dawn directly probe the birth of the first stars and galaxies, opening a window on astrophysics at high redshift that was previously accessible only through theory.

\subsubsection{Epoch of Reionization (IGM Transformation, $\mathbf{z \sim 15-6}$)}
As star formation accelerated, the Epoch of Reionization (EoR) unfolded, overlapping with the late stages of cosmic dawn. UV photons from young galaxies (and possibly quasars) gradually ionized the surrounding hydrogen gas, carving out growing ionized (HII) regions in the neutral IGM. Initially these ionized bubbles were small and isolated, but over time they expanded and merged. The volume-averaged neutral fraction of the universe dropped from essentially unity to a few percent by the end of reionization. The 21 cm signal during the EoR became highly patchy. In neutral regions that were already heated ($T_s \gg T_{\text{CMB}}$), the 21 cm line appeared in emission. In contrast, within ionized zones (or where gas was fully ionized), the 21 cm signal was absent entirely. Thus, 21 cm observations of the EoR can spatially map the distribution of neutral and ionized regions across the universe. The characteristic size and growth of these 21 cm “bright” (neutral) and “dark” (ionized) patches inform us about the nature of reionization sources and the timeline of this phase transition (McQuinn et al. 2007; Friedrich et al. 2011). For instance, a rapid reionization would result in large, mergeable ionized regions appearing over a short interval, whereas a more extended reionization would produce a mix of bubble sizes over a longer period. Current observations (e.g. Gunn-Peterson troughs in $z\sim6$ quasar spectra and CMB polarization measurements) indicate reionization completed by $z\approx6$–7 (Fan et al. 2006; Planck Collaboration 2016a). The 21 cm signal provides a direct probe of this process, in contrast to these indirect tracers. By measuring the 21 cm power spectrum or imaging the neutral hydrogen distribution, one can constrain the evolving ionizing photon budget and ionization topology – for example, determining the efficiency of galaxies in ionizing the IGM and the clumpiness of gas that absorbs these photons. 
% (Robertson et al. 2010; Greig \& Mesinger 2017)
In summary, the EoR 21 cm signal links cosmological structure formation with early galactic astrophysics, illuminating how the universe’s diffuse gas was transformed from fully neutral to (almost) fully ionized.

\red{include a graphic of the 21cm global signal, with shading, similar to Jiten's first year report.}

\subsection{21-cm Observables}

In astronomy, imaging a signal over a solid angle of sky is often seen as the holy grail of an experimental field. Unfortunately, in the case of 21-cm astronomy, this is inaccessible for a number of physical reasons. First and foremost, the 21-cm signal is extremely faint, with signals from the Epoch of Reionization often on the order of $1 \text{mK}$ to $10 \text{mK}$.
% \red{cite Furlanetto et al. 2006, Morales \& Wyithe 2010}
In contrast, a single radio-antenna system at  $\sim 150 \text{MHz}$ (within the 50 to 250 MHz frequency band of HERA \citep{DeBoer_2017}) receives hundreds to thousands of kelvin of Galactic synchrotron emission and receiver noise. Because of this low signal-to-noise (SNR) ratio, there is not enough sensitivity to produce a high-fidelity image. In addition to this, recent experiments in 21-cm astronomy have heavily favoured interferometric approaches over single-dish approaches, due to the advantage that variable and vastly long baselines are essential in providing high angular resolution, as well as the statistical simplicity in data correlation -- specifically, the lack of bias in estimation. However, interferometers inherently miss the total power unless single-dish auto-correlations are included, which is impractical in current experiments due to dominant receiver systematics. \red{cite}

Therefore, experiments in the field of 21-cm astronomy rely on statistical observations to inform the history of the universe. The most important of these is arguably the \textit{power spectrum}, whose measurement is the main focus for many current experiments \citep{DeBoer_2017}. To define the power spectrum, first consider the three-dimensional Fourier transform from physical space to Fourier space, defined by

\begin{equation}
    \tilde{T} (\textbf{k}) \equiv \int^\infty _{-\infty} d^3 r e^{-i\textbf{k} \cdot \textbf{r}} T(\textbf{r})
\end{equation}

\noindent where $\textbf{r}, \textbf{k}$ are comoving position and comoving wave- vectors respectively. The inverse transform is given by 

\begin{equation}
    T(\textbf{r}) = \frac{1}{(2 \pi)^3} \int^\infty _{-\infty} d^3 k e^{i \textbf{k} \cdot \textbf{r}} \tilde{T}(\textbf{k}).
\end{equation}

The power spectrum can then be defined by the equation

\begin{equation}
    \langle \tilde{T} (\textbf{k}) \tilde{T} (\textbf{k}') ^{*} \rangle = (2 \pi)^3 \delta^{D}  (\textbf{k} - \textbf{k}') P(\textbf{k})
\end{equation}

\noindent with $\delta^D$ the Dirac delta function in $D$ dimensions, and $\langle ... \rangle$ the ensemble average operation. Equivalently, and perhaps more intuitively, the power spectrum can be interpreted as the Fourier transform of the correlation function $\xi(\textbf{x}) \equiv \langle T(\textbf{r}) T(\textbf{r} - \textbf{x}) \rangle$, emphasizing the fact that the power spectrum measures correlations in configuration space, but simply is expressed in Fourier space:

\begin{equation}
    \xi(\textbf{x}) = \int \frac{d^3 k}{(2 \pi)^3} P(\textbf{k}) e^{-i \textbf{k} \cdot \textbf{x}}.
\end{equation}

This definition of the power spectrum includes the necessary information to completely statistically characterise a Gaussian random field \citep{Coles_2001}, which underlies inflationary models. In cosmological literature, though, it is the quantity 

\begin{equation}
    \Delta^2 (k) \equiv \frac{k^3}{2\pi^2} P(k)
\end{equation}

\noindent which is more commonly seen. The reason for plotting this quantity $\Delta^2$ instead of $P(k)$ can be explained by considering the variance of a zero-mean random temperature field, as in, for example, the case of the mean-subtracted 21-cm brightness temperature field:

\begin{equation}
\begin{split}
    \langle T^2 (\textbf{r}) \rangle
    & = \left\langle \left( \int^\infty _{-\infty} \frac{d^3 k}{(2\pi)^3} e^{i \textbf{k} \cdot \textbf{r}} \tilde{T} (\textbf{k}) \right) \left( \int^\infty _{-\infty} \frac{d^3 q}{(2\pi)^3} e^{i \textbf{q} \cdot \textbf{r}} \tilde{T} (\textbf{q}) \right)^{*} \right\rangle \\
    & = \int^\infty _{-\infty} \frac{d^3 k}{(2\pi)^3} \frac{d^3 q}{(2\pi)^3} e^{i (\textbf{k} - \textbf{q}) \cdot \textbf{r}} \langle \tilde{T} (\textbf{k}) \tilde{T} (\textbf{q})^{*} \rangle \\
    & = \int^\infty _{-\infty} \frac{dk^3}{2\pi^2} P(k) \\
    & = \int^\infty _{0} d \ln k \Delta^2 (k).
\end{split}
\end{equation}

\noindent Therefore, $\Delta^2 (k)$ can be interpreted as the contribution to variance in configuration space in each logarithmic $k$ bin.

While the power spectrum holds information about spatial fluctuations, it is also informative to investigate the \textit{global signal} $\overline{T}_b$, defined as 

\begin{equation}
    \overline{T}_b (\nu) = \int d\Omega T_b (\hat{\textbf{r}}, \nu).
\end{equation}

\noindent As the notation suggests, this is an averaged quantity; specifically, it is the average power of the 21-cm signal across all sky angles, as a function of frequency.


% \subsection{Linear Cosmological Perturbations}
% \red{https://arxiv.org/pdf/astro-ph/0103017}
\subsection{Initial conditions}
\subsubsection{Mass overdensities}
The current inflationary model of the Universe assumes that there existed some primordial power spectrum, imprinted at some arbitrarily early time \citep{Coles_2001}. The primordial power spectrum is defined by 

\begin{equation}
    P_0 (k) = A_s \left( \frac{k}{k_*} \right)^{n_s - 1},
    \label{eq:primordial_power_spectrum}
\end{equation}

\noindent where $k_*$ is the pivot scale $0.002 \text{Mpc}^{-1}$,
%\footnote{sometimes also chosen as $0.005 \text{Mpc}^{-1}$ in other conventions}
$A_s$ the amplitude of the spectrum at the pivot scale, and $n_s$ the scalar spectral index. This scalar spectral index represents the tilt of the power spectrum, with $n_s = 1$ corresponding to the Harrison-Zeldovich spectrum \citep{Harrison_1970, Zeldovich_1972}, physically meaning that the power is scale invariant.

This primordial power spectrum is related to the power spectrum at each time through a \textit{transfer function} \citep{Bardeen_1986}. These phenomenological transfer functions mathematically encode how primordial density fluctuations are affected by processes such as radiation pressure, horizon entry, particle free-streaming \citep{Coles_2001}. Closed-form examples of fitting functions used as transfer functions can be found in, for example, \citet{Bardeen_1986, Eisenstein_Hu_1998}. As a function of wavenumber, the processed power spectrum $P(k)$ relates to the primordial power spectrum $P_0 (k)$ through the transfer function $T(k)$ by the relation

\begin{equation}
    P(k) = P_0 (k) T^2 (k).
    \label{eq:processed_power_spectrum}
\end{equation}

\subsubsection{Streaming velocity effect}
The streaming velocity effect is the result the flows of baryons relative to the velocity of potential wells created by dark matter \citep{Tseliakhovich_Hirata_2010}. This effect is found to have non-negligible effects on structure formation: specifically, it suppresses the formation of haloes at small scales. This imprints on the 21-cm matter power spectrum as a decrease in power near Jeans scale \citep{Tseliakhovich_Hirata_2010} -- the critical length scale at which density perturbations in gas clouds overcome pressure to gravitationally collapse \citep{Jeans_1902}. \red{find somewhere to expand on this Jeans scale a little bit, including an equation to be referenced in the results section.}

To define $v_{bc}$, the velocity divergence must first be defined as 

\begin{equation}
    \theta \equiv a^{-1} \nabla \cdot \textbf{v}
    \label{eq:velocity_divergence}
\end{equation}

\noindent where $a$ is the dimensionless cosmological scale factor of the universe. 
%\red{what is this divergence physically?} 
Then, the relative velocity is

\begin{equation}
    \textbf{v}_{bc} = \frac{\hat{k}}{ik} \left[ \theta_b (\textbf{k}) - \theta_c (\textbf{k}) \right]
    \label{eq:vbc_definition}
\end{equation}

\noindent where the subscripts $b$ and $c$ denote the $\theta$ for baryons and CDM respectively. The power spectrum of $v_{bc}$ is finally given by 

\begin{equation}
\begin{split}
        \langle v_{bc}^2 (\textbf{x}) \rangle 
        & = \int \frac{dk}{k} \Delta_\zeta^2 (k) \left[ \frac{\theta_b (k) - \theta_c (k)}{k} \right]^2 \\
        & = \int \frac{dk}{k} \Delta_{\text{vbc}}^2 (k)
\end{split}
\end{equation}

\noindent where $\Delta_\zeta ^2 (k) = 2.42 \times 10^{-9}$ is the primordial curvature perturbation power spectrum \citep{Dunkley_2009}.

\section{21cmSPACE}
For any physical system, simulations are an invaluable asset for a multitude of reasons, including generating mock data from mathematical theory, which can then used for pipeline development and validation, as well as for foreground and instrumental modeling, which can then be used for experimental forecasting to inform instrument design. 

However, evolving the early universe on a machine is no easy task. Therefore, there does not exist one optimal way to simulate the period of time between recombination and reionization, but rather a multitude of different methods each with their own advantages and disadvantages. These methods lie on a spectrum with a trade off between accuracy and runtime. On one end lies numerical simulations such as \code{CoDa} \citep{Ocvirk_2015} and \code{LICORICE} \citep{Semelin_2017}, which hold accuracy as its foremost priority. This is achieved through explicit evolution of structure formation using hydrodynamic theory \citep{gessey-jones_thesis}, which can either be freshly written with the intent of simulating the 21-cm signal from nativity, or taken from a generic library upon which processes such as radiative transfer and chemical evolution can then be attached for the specific purpose of evolving the 21-cm observables. This approach, due to its theoretical ability to include a comprehensive suite of physical effects, advertises the best possible control over the processes at each evolution step. However, numerical simulations come with the heavy downside of computational cost. 
% \red{example?} 
While it is true that computer performance is exponentially increasing alongside decreasing costs, the need and expectation for improvements in simulation accuracy, size, and resolution have continued to render purely numerical simulations too expensive both in computational power and time to perform large-scale explorations of parameter spaces.

On the other end of the spectrum are analytical simulations such as \code{ARES} \citep{Mirocha_2014} and \code{Zeus21} \citep{Munoz_2023}. In contrast to numerical simulations, analytical simulations do not explicitly evolve spatial volumes through time. Instead, they solve mathematical equations, which, using the plethora of numerical solution libraries available, can take less than a second using commercial hardware \citep{gessey-jones_thesis}. However, this comes at the heavy trade-off of losing significant physical detail, with analytical equations having only the capability to model fields through averaged quantities, requiring significant approximations. Still, these calculations are of incredible value since these approximations are often subdominant compared to the inherently large observational error of the field. Despite their practical merit, though, the shortcomings of analytical simulations with regards to the lack of explicit evolution often prohibits output of full 21-cm signal maps or 21-cm power spectra.

Through the advantages and disadvantages of both numerical and analytical models, the need for a third class of simulations is hopefully clear: semi-numerical simulations. As the name suggests, semi-numerical simulations numerically resolve and evolve a spatial expanse, but rather than incorporating full hydrodynamic calculations of all processes at every step and every point in space, semi-numerical simulations invoke analytic calculations to deal with approximated quantities. Semi-numerical simulations therefore offer a compromise between accuracy and low computational cost. It is to this class of semi-numerical simulations that \code{21cmSPACE} belongs.

%% much of the following section generated by GPT, summarizing and rephrasing gessey-jones chapter 2:

\subsection{Design principles}
\code{21cmSPACE} (21-cm Semi-numerical Predictions Across Cosmic Epochs\footnote{This name was not given until mid-2023; older papers referring to this code do not include this name.}) is a code package developed by the Cambridge Cosmic Dawn Group over the past decade \citep{Fialkov_2012, Visbal_2012}. \code{21cmSPACE} evolves large-scale structure using analytic or perturbative solutions, while key astrophysical processes are included via parametric, sub-grid models and numerical integration where necessary. The core aim of \code{21cmSPACE} is to propagate the 21-cm brightness temperature field forward in time, in order to compute observable quantities such as the global (sky-averaged) 21-cm signal and its power spectrum. To achieve this, the code self-consistently tracks the evolution of all relevant fields -- e.g., the hydrogen spin temperature $T_S$, the background radiation temperature $T_{\text{CMB}}$, the hydrogen neutral fraction $x_{\text{HI}}$, as well as derived quantities like star formation rates and radiation intensities.

By design, \code{21cmSPACE} divides the problem according to scale: large-scale intergalactic fields (such as density, velocity, radiation backgrounds) are evolved on a coarsely resolved simulation grid, while small-scale phenomena (halo collapse, star formation, feedback) are handled by sub-grid prescriptions. 
%\red{include illustration as in thomas thesis?} 
This separation of scales is the key to computational efficiency, without needing to sacrifice essential physical processes.

Several design philosophies underlie \code{21cmSPACE}. First, it emphasises flexibility in exploring astrophysical scenarios -- a wide array of input parameters
% \red{include table like in thomas thesis?} 
control star formation efficiencies, feedback strengths, spectral emissivities, etc., enabling the user to test different models of early-Universe astrophysics. For example, the efficiencies of Pop II  and Pop III star formation ($f_{\textasteriskcentered,II}$, $f_{\textasteriskcentered,III}$) and the delay time between Pop III and Pop II episodes ($t_{\text{delay}}$) are all tunable inputs. Likewise, the relative X-ray luminosity of high-$z$ X-ray binaries ($f_X$) and any additional radio background strength ($f_r$) can be specified. Second, the code is structured for performance: any components of the calculation that do not depend on the specific astrophysical parameters are precomputed once and stored for reuse. This includes, for instance, cosmological tables, linear perturbation growth factors, and radiation window functions (used for fast radiative transfer). Third, \code{21cmSPACE} assumes a fixed cosmological model during a run (by default the Planck 2013 $\Lambda$CDM parameters) and is optimized under that assumption. 
% In principle the cosmology can be changed by updating internal lookup tables and regenerating precomputed grids, but the code is primarily designed to vary astrophysical inputs rather than cosmological ones, since uncertainties in high-$z$ astrophysics are much larger than current cosmology uncertainties. 
Overall, the architecture of \code{21cmSPACE} prioritizes physical fidelity (by including all major known 21-cm relevant processes) while maintaining speed through analytical treatments and precomputation. This makes it well-suited to produce rapid predictions of 21-cm observables across cosmic dawn and reionization for a range of scenarios.

%%

\subsection{Main Simulation Loop}

Loosely, \code{21cmSPACE} applies the following set of instructions upon each execution \citep{gessey-jones_thesis}:

\begin{enumerate}
    \item A spatial volume is divided into cubical voxels of a specific side length.

    \item Large-scale fields such as the Lyman-Werner field are initialized at the first time step from initial conditions, or computed from the previous time step.

    \item These large-scale fields are used by sub-grid models within each voxel to calculate local properties, such as star formation prescription.

    \item The local properties are then used to inform the large-scale fields, propagated by non-local processes such as radiative transfer.

    \item Steps 2-4 are iterated until termination.
\end{enumerate}

Temporally, \code{21cmSPACE} operates in redshift space with hard-coded endpoints, evolving from $z = 50$ to $z = 6$. Across these redshifts, the Universe is described by linear perturbation theory. At $z = 50$, there is also negligible halo and star formation, permitting the use of the \code{CAMB}\footnote{The Code for Anisotropies in the Microwave Background is a code for calculating various cosmological quantities, including power spectra and transfer functions.}\citep{Lewis_Challinor_2011} and \code{Recfast}\footnote{Recfast provides fast approximations for calculations of observables resulting from processes during the Epoch of Recombination, the era immediately preceding the period informed by 21cm astronomy.}\citep{Seager_2011} codes for the creation of initial conditions \citep{gessey-jones_thesis}.

Spatially, the total size of \code{21cmSPACE} can be set to one of $384^3 \text{ cMpc}^3$, $768^3 \text{ cMpc}^3$, and $1536^3 \text{ cMpc}^3$ by changing the number of $3 \text{ cMpc}$ side-length voxels to $128^3$, $256^3$, and $512^3$ respectively \citep{dhandha_2022}. This largest simulation size of $1536^3 \text{ cMpc}^3$ allows \code{21cmSPACE} to be useful in the forecasting for the SKA, whose beam covers a large enough square-angle at high redshifts to require this volume. The voxel side-length itself, however, is currently hard-coded, which is disadvantageous since requiring $512^3$ voxels to simulate a $1536^3 \text{ cMpc}^3$ box causes a single execution to cost upwards of 23000 CPU hours. Therefore, although it is possible to use \code{21cmSPACE} to forecast for experiments such as the SKA, the large number of simulations needed to adequately explore the parameter space of initial conditions renders the package nonviable in practice. On Cambridge's Wilkes3 HPC cluster, this costs hundreds of GBP, takes approximately 2 weeks to complete, and contributes $175 \text{ gCO}_2\text{eq}$ of greenhouse gases \citep{dhandha_2022}.

Additionally, the initial conditions are currently calculated from fixed parameters. In particular, \code{21cmSPACE} assumes the Planck 2013 best-fit $\Lambda$CDM model as a fixed cosmology \citep{Planck2013results}. The initial over-density field $\delta_m$ and baryon-dark matter relative velocity $v_{bc}$ are computed \citep{Fialkov_2012} from the matter power spectrum and velocity power spectrum as output from \code{CAMB}, and the initial gas temperature and ionization fraction are calculated from the outputs provided by \code{Recfast}, both assuming Planck 2013.

In-depth descriptions of \code{21cmSPACE} and its parameters, simulation loop, and post-processing can be found in \citet{Gessey-Jones_2023, Gessey-Jones_2024, gessey-jones_thesis}.

\subsection{Project motivation and impact}

\code{21cmSPACE}, while being a powerful tool for simulation of the 21-cm signal, still holds some limitations. Particularly, as outlined in the previous section, despite there offering the option to include or exclude effects from a plethora of physical evolutionary processes, the instantiation of the simulation from its initial conditions remains confined to the use of its default Planck 2013 best fit cosmology, and propagation thereof. This is an extremely strong assumption affecting many of the physical processes throughout the evolution of the 21-cm signal.

However, there is great value to be gained from the ability to evolve the 21-cm signal for variable cosmologies. As the amount of experimental data measuring various observable imprints of the 21-cm signal continues to increase, so too does the potential to use 21-cm data as a probe for constraining cosmological parameters. Specifically, the 21-cm signal depends on five cosmological parameters, as summarized in Table \ref{tab:cosmological_parameters}.


\begin{table}
    \centering
    \begin{tabular}{|c|l|c|}
        \hline
        Parameter & Definition & Planck 2013 best-fit value\\ \hhline{|=|=|=|}
        $h$ & Dimensionless Hubble constant & $0.6704$\\ \hline
        $\Omega_{\text{b}, 0}$ & Dimensionless baryonic matter density at $z = 0$ & $0.022032$\\ \hline
        $\Omega_{\text{dm}, 0}$ & Dimensionless dark matter density at $z = 0$ & $0.12038$\\ \hline
        $\Omega_{\text{k}, 0}$ & Dimensionless effective curvature density at $z = 0$ & $0$\\ \hline
        $T_{\text{CMB},0}$ & Temperature of the Cosmic Microwave Background (CMB) at $z = 0$ in K & 2.725\\ \hline
    \end{tabular}
    \caption{Cosmological parameters impacting the 21-cm signal, along with their definitions and 2013 best-fit values, as is included in the default settings of \code{21cmSPACE}.}
    \label{tab:cosmological_parameters}
\end{table}


% \begin{table}[!h]
%     \centering
%     \begin{tabular}{|c|c|}
%         \hline
%         Parameter & Value\\ \hhline{|=|=|}
%         $h$ & $0.6704$\\ \hline
%         $\Omega_{\text{b}, 0}$ & $0.022032$\\ \hline
%         $\Omega_{\text{dm}, 0}$ & $0.12038$\\ \hline
%         $\Omega_{\text{k}, 0}$ & 0\\ \hline
%         $T_{\text{CMB},0} ~ / ~ \text{K}$ & 2.725 \\ \hline
%     \end{tabular}
%     \caption{Planck 2013 parameter values}
%     \label{tab:Planck13_parameter_values}
% \end{table}

% These parameters propagate through \code{21cmSPACE} through two main avenues: the initial conditions, which is an umbrella term comprising of the cosmological density fluctuation $\delta(\textbf{x})$ and the baryon-dark matter relative velocity $v_{\text{bc}}(\textbf{x})$, as well as the halo mass function $dn/dM$. The underlying cosmology in \code{21cmSPACE} can therefore be changed by altering these functions. As a result, the effects of these varied cosmological parameters will be propagated through the evolution of the 21-cm signal, and finally imprinted on the observables of the 21-cm global signal and the 21-cm power spectrum.

The functionality to incorporate cosmological parameters into the inputs of \code{21cmSPACE} would be incredibly useful, and is the objective of a longer-term endeavour. A natural beginning towards this objective is the incorporation of cosmology dependence into the generation of initial conditions. These initial conditions are extremely sensitive to the underlying cosmology of the Universe, and their cosmology dependence is found to propagate significantly through the evolution of the 21-cm signal. The completion of this goal is a major step towards the full incorporation of cosmology dependence into the full simulation of the 21-cm signal.

% The implementation of cosmology dependence into the generation and processing of initial conditions, as well as their propagation through 21-cm evolution, is a major step in this direction.

In principle, the full incorporation of cosmology into \code{21cmSPACE} will enable exploration of the cosmological parameter space, relating each point in the space to a particular shape of the global signal and a particular shape of the power spectrum. Along with experimental data, the parameter space may then be constrained to narrow down possible locations for the true cosmology of the Universe. As well as this, the comparison of simulated signals with physical measurements will enable the verification or rejection of cosmological theories.




\newpage
\section{Methodology}
\subsection{Baseline 21cmSPACE Operation}
\code{21cmSPACE} takes as input pre-computed 3-dimensional initial condition grids: the matter over-density field $\delta_m(\textbf{x})$ and the relative velocity field $v_{bc}(\textbf{x})$, and global values for the initial gas temperature and ionization fraction. These were previously hard-coded to follow the Planck 2013 cosmology, with parameters defined as the best estimates of the Planck collaboration's results \citep{Planck2013results} , as shown in Table \ref{tab:Planck13_parameter_values}. 

%values come from planck2013 parameters paper table 2, Planck+WP best fit



\subsection{Initial Conditions Generation}

The generation of initial conditions is done primarily in the MATLAB function \code{get\_IC\_N}. The function takes the two inputs: $N_{pix}$, which represents the side-length of the total simulated spatial volume in number of pixels, and a random seed. The function then outputs two 3-dimensional scalar fields representing the $\delta_m$ field and the $v_{\text{bc}}$ field, where the first array holds the unitless deviation from average density, and the second array holds the relative velocity between baryons and CDM in units of $\text{km} \text{s}^{-1}$. 

\code{get\_IC\_N} also further imports three precomputed files, each for a different redshift from $\{40, 970, 1020\}$ containing transfer function data output by \code{CAMB}. In order to define the primordial power spectrum to be multiplied with these transfer functions as in eq. \ref{eq:primordial_power_spectrum} and eq. \ref{eq:processed_power_spectrum}, \code{21cmSPACE} uses hard-coded values of $A_s = 2.01664 \times 10^{-9}$ \footnote{\red{source?}} and $n_s = 0.9675$, with $n_s$ consistent with the Planck2013 best fit model \citep{Planck2013results}. 
% These values are considered by some to be part of what defines a cosmology; however, this is not unanimous.
% ns is from the Planck+lensing column of table 2, not Planck+WP like the other cosmological parameters?

These transfer functions from each redshift are then used in \code{get\_IC\_N} to calculate the over-density field fluctuations $\delta_m$, $\delta_b$, and $\delta_c$ for each of total matter, baryons, and cold dark matter respectively. To do this, they are first passed through a smoothing window function defined by 

\begin{equation}
    W(k) = \text{exp}\left( -\frac{k^2 R_w ^2}{2} \right)
\end{equation}

\noindent where $R_w$ is a characteristic smoothing scale, chosen to be $R_w = 1.7 / \pi$ for the smoothing of $3 ~\text{Mpc}$ pixels.
%\footnote{\red{how was this chosen?}}
This window function serves the purpose of smoothing scales smaller than $R_w$ in Fourier space, which correspond to higher $k$ values. The quantities are then defined as follows:

\begin{equation}
    \begin{split}
        \delta_m & = W(k) \left[ \left( \frac{\Omega_b}{\Omega_m} T_{\text{baryon}} \right) + \left( \frac{\Omega_m - \Omega_b}{\Omega_m} T_{\text{CDM}} \right) \right] k^2 \left( P_0 (k) \right)^{1/2} \\
        \delta_b & = W(k) ~ T_{\text{baryon}} k^2 \left( P_0 (k) \right)^{1/2} \\
        \delta_c & = W(k) ~ T_{\text{CDM}} k^2 \left( P_0 (k) \right)^{1/2}
    \end{split}
\end{equation}

These quantities are then used to define the relevant power spectra. The mass power spectrum is somewhat simple to calculate: 

\begin{equation}
    P_m(k) = 2\pi^2\Delta_\zeta ^2 (k) \frac{\delta_m^2}{k^3}
\end{equation}

\noindent where $\Delta_\zeta ^2 (k) = 2.42 \times 10^{-9}$ is again the primordial curvature perturbation power spectrum \citep{Dunkley_2009}. 
%should this also be changed with cosmology, since it relies on WMAP data?

The $v_{bc}$ power spectrum, however, is less straightforward. First, the velocity divergences must be calculated as in eq. \ref{eq:velocity_divergence}. This is impractical to do analytically; rather, in practice, the baryon velocity divergence is calculated using

\begin{equation}
    \theta_b = \frac{H(z_{rec})}{c} (z_{rec} + 1) \frac{\delta_{b, 1020} - \delta_{b, 970}}{50}
    \label{eq:velocity_divergence_practical_calculation}
\end{equation}

\noindent with $z_{rec} = 1020$ the redshift of recombination at which the initial conditions are generated, and the $1020$ and $970$ subscripts denoting the redshift at which $\delta$ is evaluated. The CDM velocity divergence is calculated similarly.

The relative velocity 
%\red{transfer function (what is this called, and what symbol should i use? and why is there no square?)}
$v_\text{bc}$ is then calculated according to the scalar form of eq. \ref{eq:vbc_definition}, appropriately scaling by the redshift:

\begin{equation}
    v_\text{bc} = \frac{\theta_b - \theta_c}{i k (z_{rec} + 1)}.
\end{equation}
% the i in the denominator is not multiplied at this stage.

Finally, the $v_{bc}$ power spectrum is calculated explicitly:

\begin{equation}
    P_{\text{vbc}} = 2 \pi^2 \Delta_\zeta ^2 (k) \frac{I_{\text{vbc}}}{k^3}
\end{equation}

Now that the matter power spectrum and relative velocity power spectrum have been explicitly calculated, the true generation of initial conditions may begin. First, a Gaussian random field is initialized in configuration space. Then, its Fourier transform is taken -- since the power spectrum correlates in Fourier space, it may only be applied in Fourier space. Initializing in configuration space before taking the Fourier transform enforces Hermitian symmetry, which is essential for maintaining real (as opposed to complex) over-density fields. Further, the Gaussianity of the overdensities is preserved due to the fact that the Gaussian distribution is an eigenfunction of the Fourier transform. 

This method, though, requires some normalization to be performed. The Fourier space variables are multiplied by a normalization constant $1 / \sqrt{L_{\text{pixel}}}$ and divided by their magnitude, and combed through 
%\footnote{\red{this is what is done in \code{get\_IC\_N.generate\_k\_values}, but what is it doing physically? and why is there a discontinuity in the middle?}} Is this sigma8 normalization? 
sheet-by-sheet to impose phase changes such that the complex random variables in the simulation box experience one full revolution of phase. After this is done in all three axes, the power spectra can at last be imposed, scaling the random field in Fourier space to ensure that the perturbations match the cosmological model. This scaling is done using the same random variable base for the scalar $\delta_m$, as well as the $v_{bc}$ along each of the three spatial dimensions separately.

Finally, the Fourier space variables are inverse Fourier transformed back into configuration space, and the three $v_{bc}$ fields for each of the spatial dimensions are converted into a scalar field by taking the total magnitude of the three axis velocities. It is these configuration space boxes that are the final output of \code{get\_IC\_N}.

In order to implement variable cosmological parameters, \code{get\_IC\_N} was translated into Python. This decision was made for two reasons: firstly, the transfer functions used in the evolution of the power spectrum are output by \code{CAMB}, which is a code written mostly in Python. Secondly, the final implementation of variable cosmology in \code{21cmSPACE} strives to use the Python-based \code{astropy} module's cosmology classes as an organizational tool for holding parameter values, as well as its object methods for performing standard cosmological calculations (such as calculating $h$ at a given redshift). 

% Since the conventions used between \code{CAMB} and \code{astropy} are not identical, a \code{set\_cosmology\_camb} wrapper was written for \code{CAMB}'s \code{pars.set\_cosmology} method. In particular, astropy's value for $\Omega_b, 0$ and $\Omega_c, 0$ differ from \code{CAMB}'s input by a factor of $h^2$; this wrapper multiplies by the relevant factors before passing the values to \code{CAMB}. 
% %\footnote{There is also some issue with the Tcmb0's datatype from astropy needing removal of unit, but documentation is hard to find for this.}

To receive information about cosmological parameters, the function \code{get\_IC\_N} was altered to take cosmology as an input parameter. Specifically, in addition to the two inputs of $N_{pix}$ and random seed, \code{get\_IC\_N} takes a cosmology as a third parameter. This cosmology itself is defined by the five parameters in tab. \ref{tab:cosmological_parameters}.
%an \code{astropy.cosmology} instance such as \code{FlatLambdaCDM} or \code{LambdaCDM} as a third parameter. 

Practically, the cosmology enters \code{get\_IC\_N} in two ways. Most obviously, the transfer functions encoding effects such as inflation and horizon interaction are sensitive to the cosmological parameters. While these were previously precomputed and saved in the interest of computational efficiency, they must be recalculated for every cosmology, and therefore it is logistically sensible for the calling of \code{CAMB} to be directly incorporated as a subroutine within \code{get\_IC\_N}. The execution of \code{CAMB}, from instantiation using parameters to the output of the transfer functions for each of the three redshifts required, takes on the order of seconds on commercial hardware when using \code{CAMB}'s default settings such as those governing the $k$ range probed and the resolution of $k$ sampling. While these settings can be changed to improve accuracy, which was originally done in the precomputed transfer functions, in practice this was found to make no difference in the final initial conditions. 
% \footnote{\red{show evidence?}}

Those familiar with \code{CAMB} may be aware that \code{CAMB} has the built-in functionality to output the power spectra directly
%as shown in section \ref{}
, thus avoiding the need to manually scale and process the power spectrum from its primordial form. However, the manual scaling of the power spectrum was implemented as a design choice because the \code{CAMB} output power spectrum does not include the smoothing required at high $k$ values. As well as this, manual scaling offers a level of control over the primordial power spectrum that sets up future work.

As well as this, the calculation of velocity divergence requires the value of $H$ at a specific redshift. This was previously done by implementing the FRW equation

\begin{equation}
    (H(z))^2 = H_0^2 (\Omega_m (1 + z)^3 + \Omega_\Lambda + \Omega_R (1+z)^4)
\end{equation}

\noindent with hard-coded critical densities $\Omega_m$ and $\Omega_\Lambda$, and the radiation pressure $\Omega_R$ hard-coded to $8.5522 \times 10^{-5}$ \footnote{\red{where is this from?}}. To keep consistent with the input cosmology, this \code{get\_H\_z} method is now instead updated to use critical density values as provided by the given cosmology.

% replaced with the \code{astropy.cosmology} instance's \code{H} method.

Since the new code is all written in the same language, a given random seed should cause all calculations to be deterministically performed. Therefore, any discrepancy in the initial condition grids must be due to a difference in the propagation of the cosmological parameters. This is illustrated in fig. \ref{fig:IC_WMAP9_Planck18}, which show a slice of initial condition boxes generated using the same random seed: the upper plots show that the initial conditions are, by eye, very similar (due to the deterministic nature of the random draws with a fixed seed). The lower plot, however, shows the difference in initial condition boxes, with deviations of up to $5 \%$.

\begin{figure}
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_grids/initial_condition_grid_WMAP9.png}
         \caption{A slice of the initial condition boxes for cosmology WMAP9, with $\delta_m$ on the left and $v_{\text{bc}}$ on the right.}
         \label{fig:IC_WMAP9}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_grids/initial_condition_grid_Planck18.png}
         \caption{A slice of the initial condition boxes for cosmology Planck 2018, with $\delta_m$ on the left and $v_{\text{bc}}$ on the right.}
         \label{fig:IC_Planck18}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_grids/difference_in_initial_grid_WMAP9_Planck18.png}
         \caption{The differences between initial condition grids generated using WMAP9 and Planck 2018 with $\delta_m$ on the left and $v_{\text{bc}}$ on the right, calculated by subtracting the respective Planck 2018 slices in fig. \ref{fig:IC_Planck18} from the WMAP9 slices in \ref{fig:IC_WMAP9}.}
         \label{fig:IC_difference_WMAP9_Planck18}
     \end{subfigure}
        \caption{\ref{fig:IC_WMAP9} and fig. \ref{fig:IC_Planck18} show slices of initial condition boxes for the cosmologies using WMAP9 and Planck 2018 best fit parameters respectively. These \ref{fig:IC_difference_WMAP9_Planck18} shows the effect}
        \label{fig:IC_WMAP9_Planck18}
\end{figure}

% \subsection{Incorporation of Cosmology into the Halo Mass Function}
\subsection{Consistency Checks}
Although the rewriting of code maintained the same mathematical algorithm, translating code from one language into another often introduces inconsistencies due to the nature of hardware interaction, or variations in implicitly-called library package subroutines. It is therefore important to perform consistency checks at every stage, in order to maintain confidence that the simulation is reflective of the underlying physics.

Due to the statistical nature of measurements, however, the stochacity in the initialization of the random Gaussian field propagates through the imposition of the power spectrum, imprinting inherent randomness onto the final result. To complicate matters further, the generation of random Gaussian fields is non-identical between MATLAB and Python, even when using the same random seed. 
% \red{Why? Saswata and Furen pointed this out in group meeting -- usually it should be the same, but specifically in 3D or in random Gaussian field it is different.} 

It is therefore important to iterate the algorithm in both MATLAB and Python multiple times, and statistically compare the power spectra that these initial condition boxes produce. Specifically, after generating the initial condition boxes, the power spectrum can be computed independently from its generation. Taking each power spectrum from individual initial condition boxes, their average value at each $k$ sample may be calculated as a best estimate of the power at that wavenumber; similarly, the standard deviation of the power value at each $k$ sample may be used as an estimate of the uncertainty in the power, as a result of propogation of randomness from the initial Gaussian field. In principle, averaging an infinite number of iterations will return the original power spectrum which should perfectly agree with each other. However, in practice, each algorithm has an associated computational cost, limiting the number of samples; yet, as shown in fig. \ref{fig:compare_generators_noCAMB}, only as few as $10$ runs is needed to clearly illustrate the agreement of the two code scripts with each other. The plots also include the fractional error, calculated by taking the absolute difference between the two methods, and then dividing by the legacy method's best estimate.

As is shown in the fractional error plots, the deviation between the legacy and new scripts is negligible; furthermore, all error bars overlap with $0 \%$ error, signifying that the legacy and new scripts, despite written in different languages and having different subroutines for the initialisation of Gaussian random fields, perform the same calculations and, more importantly, preserve the physics behind the computation.

The incorporation of \code{CAMB} into each execution of \code{get\_IC\_N} is also a potential source of deviation. As \code{CAMB} is an independently maintained code package, it is possible that \code{CAMB} has undergone changes in its parameters, calculation, or post-processing over the decade since the original legacy precomputed transfer functions used in \code{get\_IC\_N} were written to file. Therefore, it is useful to check that \code{get\_IC\_N}'s output, when using the legacy code with hard-coded Planck 2013 parameters, is consistent with the new code when directly calling \code{CAMB}, also using Planck 2013 parameters. The comparisons are shown in fig. \ref{fig:compare_generators}.

The fractional error plot in $v_{bc}$ shows all error bars overlapping with $0$ error; therefore, the $v_{bc}$ calculation when incorporating \code{CAMB} can be taken to be statistically identical. However, fractional error in the $\delta_m$ power spectrum shows an error of about $3 \%$, 
% This is perhaps unsurprising, \red{since the legacy generation used parameters drawn from different sources, some updated over the years}. As well as this, 
which is negligible in the scheme of current instrumental errors in observational 21-cm astronomy. Together, these consistency checks are enough to approve the use of the \code{CAMB}-incorporated Python version of \code{get\_IC\_N} into \code{21cmSPACE}.

\newpage
\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_generators_averaged_power_spectra_with_residual_noCAMB_delta_m.png}
         \label{fig:compare_generators_power_spectrum_noCAMB_delta_m}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_generators_averaged_power_spectra_with_residual_noCAMB_v_bc.png}
         \label{fig:compare_generators_power_spectrum_noCAMB_vbc}
     \end{subfigure}
        \caption{The upper axes in each pair of plots show a comparison of power spectra between legacy and new initial condition generation scripts, \textbf{before} the incorporation of \code{CAMB}. Best estimates are calculated using the average of power at each $k$ sample over $10$ iterations to smooth out effects from randomness in the initial Gaussian draws, and error bars are calculated by taking the standard deviation of the same quantity. The lower axes show the fractional error between the two scripts with errors from the two sources properly propagated, treating the legacy script as truth. \red{plot formatting needs to be touched up}}
        \label{fig:compare_generators_noCAMB}
\end{figure}

\newpage
\newpage
\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_generators_averaged_power_spectra_with_residual_delta_m.png}
         \label{fig:compare_generators_power_spectrum_delta_m}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_generators_averaged_power_spectra_with_residual_v_bc.png}
         \label{fig:compare_generators_power_spectrum_vbc}
     \end{subfigure}
        \caption{The upper axes show a comparison of power spectra between legacy and new initial condition generation scripts, \textbf{after} the incorporation of \code{CAMB}. Best estimates are calculated using the average of power at each $k$ sample over $10$ iterations to smooth out effects from randomness in the initial Gaussian draws, and error bars are calculated by taking the standard deviation of the same quantity. The lower axes show the fractional error between the two scripts with errors from the two sources properly propagated, treating the legacy script as truth. \red{plot formatting needs to be touched up}}
        \label{fig:compare_generators}
\end{figure}

% With the infrastructure in place, it is also important to check that different cosmologies indeed imprint differences in the power spectra. This is shown in fig. \ref{fig:compare_cosmologies_averaged_IC_power_spectra}: in the range of wavenumbers simulated by \code{21cmSPACE}, there is already measurable differences depending on the cosmology used.

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.9\columnwidth]{images/ic_power_spectra/compare_cosmologies_averaged_power_spectra.png}
%     \caption{CAPTION}
%     \label{fig:compare_cosmologies_averaged_IC_power_spectra}
% \end{figure}

\newpage
\section{Results and Discussion}
\subsection{Simulation Suite}
With the infrastructure for cosmology-dependent initial conditions successfully implemented, \code{21cmSPACE} was executed using the Planck 2018 best fit parameters \citep{Planck2018results} in the generation of initial grids. As well as this, \code{21cmSPACE} was also run using initial conditions generated with custom cosmologies. In principle, it is possible to vary any of the parameters as outlined in tab. \ref{tab:cosmological_parameters}; in this example study, the three parameters $\Omega_m$, $\Omega_b$ and $h$ are varied one at a time while holding all other parameters constant. Their parameter values are summarized in tab. \ref{tab:IC_parameters}. In each case, the other parameters are set to the best-fit Planck 2018 value. The names of the custom cosmologies are arbitrary, but here defined so that the number suffix is $10$ times the value of the parameter used in the cases of $\Omega_m$ and $h$, and $100$ times the value of the parameter used in the case of $\Omega_b$. 

\begin{table}[H]
\centering
\begin{tabular}{c c c c c c c}
\hline
Cosmology & $h$ & $\Omega_m$ & $\Omega_b$ & $\Omega_{dm}$ & $\Omega_{de}$ & $T_{\text{CMB}}$ / K \\
\hhline{= = = = = = =}
% WMAP9 & 0.6932 & 0.2865 & 0.04628 & 0.24022 & 0.71341 & 2.725 \\ \hline
Planck18 & 0.6766 & 0.30966 & 0.04897 & 0.26069 & 0.68885 & 2.7255 \\ \hline
Om1 & 0.6766 & \blue{0.1} & 0.04897 & 0.05103 & 0.89991 & 2.7255 \\
Om2 & 0.6766 & \blue{0.2} & 0.04897 & 0.15103 & 0.79991 & 2.7255 \\
Om3 & 0.6766 & \blue{0.3} & 0.04897 & 0.25103 & 0.69991 & 2.7255 \\
Om4 & 0.6766 & \blue{0.4} & 0.04897 & 0.35103 & 0.59991 & 2.7255 \\
Om5 & 0.6766 & \blue{0.5} & 0.04897 & 0.45103 & 0.49991 & 2.7255 \\ \hline
Ob3 & 0.6766 & 0.30966 & \blue{0.03} & 0.27966 & 0.69025 & 2.7255 \\
Ob4 & 0.6766 & 0.30966 & \blue{0.04} & 0.26966 & 0.69025 & 2.7255 \\
Ob5 & 0.6766 & 0.30966 & \blue{0.05} & 0.25966 & 0.69025 & 2.7255 \\
Ob6 & 0.6766 & 0.30966 & \blue{0.06} & 0.24966 & 0.69025 & 2.7255 \\
Ob7 & 0.6766 & 0.30966 & \blue{0.07} & 0.23966 & 0.69025 & 2.7255 \\
\hline
h5 & \blue{0.5} & 0.30966 & 0.04897 & 0.26069 & 0.69017 & 2.7255 \\
h6 & \blue{0.6} & 0.30966 & 0.04897 & 0.26069 & 0.69022 & 2.7255 \\
h7 & \blue{0.7} & 0.30966 & 0.04897 & 0.26069 & 0.69025 & 2.7255 \\
h8 & \blue{0.8} & 0.30966 & 0.04897 & 0.26069 & 0.69027 & 2.7255 \\
h9 & \blue{0.9} & 0.30966 & 0.04897 & 0.26069 & 0.69029 & 2.7255 \\
\hline

\end{tabular}
\caption{Cosmological parameters used in the simulations.}
\label{tab:IC_parameters}
\end{table}



Sample plots of the initial conditions are shown in fig. \ref{fig:IC_custom}. Some differences are visually obvious: the correlation in both $\delta_m$ and $v_{\text{bc}}$ are both suppressed on smaller length scales in Om1 when compared to Om5. This behaviour is expected, since higher density matter results in matter generally being closer together, and hence being able to correlate more finely. 

This is consistent with the power spectra shown in the top row of fig. \ref{fig:averaged_IC_power_spectra}: the power in both $\delta_m$ and $v_{\text{bc}}$ generally monotonically increase with higher $\Omega_m$, at least within the $k$ domain of interest. One thing to note is that the power spectrum in $v_{\text{bc}}$ also experiences some horizontal shifting towards higher $k$ (corresponding to smaller length scales) with higher $\Omega_m$, which continues to be consistent with the previous physical reasoning.

Along with this, power spectra for varying $\Omega_b$ are shown in the middle row of fig. \ref{fig:averaged_IC_power_spectra}. This time, power appears to instead decrease with increasing $\Omega_b$, both in $\delta_m$ and $v_{bc}$. In contrast to $\Omega_m$, though, varying $\Omega_b$ leaves the  does not appear to have as much of an effect on the redistribution of $v_{bc}$ power to different scales, but rather mostly changes only the amplitude.

Finally, the power spectra for varying $h$ are shown in the bottom row of \ref{fig:averaged_IC_power_spectra}, which shows an increase in power for both $\delta_m$ and $v_{bc}$ with increasing $h$, as well as another shift of power towards higher $k$ with increasing $h$.

It is important to note that since the cosmology is not yet altered in the evolutionary phase of \code{21cmSPACE}; all differences shown in later sections are a result only of the dependence of initial conditions on cosmology. This is especially pertinent in the case of varied $h$: as $h$ governs the behaviour of the Universe at each timestep, and in fact even plays a part in relating time to redshift coordinates, the effect of varied $h$ in the evolution is expected to be significant. However, the incorporation of cosmological dependence in the evolution is expected only to amplify differences. Therefore, the following results should be taken as a lower bound of possible differences, and along with $\sim 20\%$ uncertainty in \code{21cmSPACE} simulation results, the following outputs are primarily discussed in a qualitative manner.

For each varied parameter, the global signal $\overline{T}_b$ is plotted. Additionally, the 21-cm power spectra $\Delta^2(k)$ are plotted at fixed redshifts of $z = 40$ and $z = 20$, as well as at fixed wavenumber $k = 0.1 ~\text{Mpc}^{-1}$ and $k = 1 ~\text{Mpc}^{-1}$. These redshifts were chosen because at $z = 40$, the Universe is still in the midst of the dark ages before the formation of the first luminous objects, so the power spectra here provide clear insight into the structure at very early times; in contrast, by $z = 20$, the Universe is undergoing various physical processes during heating and therefore the power spectrum provides a window to the timing and evolutionary stage of the Universe at this time. Likewise, the wavenumbers $k = 0.1 ~\text{Mpc}^{-1}$ and $1 ~\text{Mpc}^{-1}$ were chosen because they are at opposing ends of the scales at which \code{21cmSPACE} probes; therefore, the power spectra at these wavenumbers is informative of structure formation both at the large and small scales.

\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_grids/initial_condition_grid_Om1.png}
         \caption{A slice of the initial condition boxes for custom cosmology Om1, with $\delta_m$ on the left and $v_{\text{bc}}$ on the right.}
         \label{fig:IC_Om1}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_grids/initial_condition_grid_Om5.png}
         \caption{A slice of the initial condition boxes for custom cosmology Om5, with $\delta_m$ on the left and $v_{\text{bc}}$ on the right.}
         \label{fig:IC_Om5}
     \end{subfigure}
        \caption{Sample slices of initial condition boxes for the custom cosmologies Om1 and Om5, shown in \ref{fig:IC_Om1} and \ref{fig:IC_Om5} respectively. The prevalence of smaller-scale correlation is clearly visible in both $\delta_m$ and $v_{\text{bc}}$ grids for the Om5 case, compared to Om1.}
        \label{fig:IC_custom}
\end{figure}

\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_cosmologies_averaged_power_spectra_Om.png}
         % \label{fig:averaged_IC_power_spectra_Om}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_cosmologies_averaged_power_spectra_Ob.png}
         % \label{fig:averaged_IC_power_spectra_Ob}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/ic_power_spectra/compare_cosmologies_averaged_power_spectra_h.png}
         % \label{fig:averaged_IC_power_spectra_h}
     \end{subfigure}
        \caption{Matter over-density power spectra $\Delta_m^2$ and $v_{bc}$ power spectra $\Delta_{vbc}^2$ for custom cosmologies (colorbar with higher values in red and lower values in blue, as defined in tab. \ref{tab:IC_parameters}) and Planck 2018 best-fit parameters (black). The x-axis is shared between each pair of plots for each cosmological parameter. The shaded region is the region probed by \code{21cmSPACE}, limited at the small scale by voxel size and at the large scale by total simulation volume. Although $\Delta_m^2$ is usually shown in logarithmic axes, they are shown here in linear axes to show the difference between cosmologies.}
        \label{fig:averaged_IC_power_spectra}
\end{figure}


\subsection{Varying $\Omega_m$}

\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/global_signal_Om.png}
         \label{fig:global_signal_Om}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_z_40_Om.png}
         \label{fig:power_spectrum_fixed_z_40_Om}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_z_20_Om.png}
         \label{fig:power_spectrum_fixed_z_20_Om}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_k_0.1_Om.png}
         \label{fig:power_spectrum_fixed_k_0.1_Om}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_k_1_Om.png}
         \label{fig:power_spectrum_fixed_k_1_Om}
     \end{subfigure}
        \caption{For custom cosmologies varying the value of $\Omega_m$, the \code{21cmSPACE} simulated 21-cm global signal (top row), the simulated 21-cm matter power spectrum at fixed $z$ (middle row: $z = 40$ on the left and $z = 20$ on the right), and the simulated 21-cm matter power spectrum at fixed $k$ (bottom row: $k = 0.1 ~\text{Mpc}^{-1}$ on the left and $k = 1 ~\text{Mpc}^{-1}$ on the right. The colorbar indicating the value of $\Omega_m$ and legend for Planck 2018 values in the top row apply to all plots.}
        \label{fig:simulation_results_Om}
\end{figure}


Out of the three cosmological parameters varied, $\Omega_m$ induces the most pronounced effect in the output of the 21-cm global signal, as shown in the top row of fig. \ref{fig:simulation_results_Om}. Most notably, the centring of the absorption trough is significantly shifted towards higher redshift for higher values of $\Omega_m$. As well as this, the depth of the absorption trough is shallower for higher values of $\Omega_m$, and the amplitude of the emission bump is also smaller for higher $\Omega_m$. The Planck 2018 best fit cosmology, which uses a value of $\Omega_m = 0.30966$, produces a curve very similar to that of the cosmology using $\Omega_m = 0.3$, which serves as a convenient consistency check. 

Since the global signal is an imprint of the thermal and ionization history of the IGM during Cosmic Dawn and the EoR, it is highly sensitive to the timing of star formation and heating processes. Varying the matter density $\Omega_m$ has the effect of dictating when structure formation primarily occurs. When the value of $\Omega_m$ is low, the universe is less dense; therefore, the density fluctuations take more time to grow, delaying the collapse of the first haloes and therefore the formation of the first stars. This delay causes Ly$\alpha$ coupling to also be delayed, occuring at lower redshifts when the gas has further cooled and the CMB temperature is lower. Therefore, the absorption trough in the global signal, which arises due to $T_s$ dropping much below $T_\text{CMB}$, is deeper and centred at later time (lower $z$). On the other hand, a high $\Omega_m$ universe collapses structure earlier and more efficiently. Hence, stars form earlier and the cosmic gas is heated by starlight earlier (higher $z$). This leads to earlier coupling and X-ray heating: the absorption trough for $\Omega_m = 0.5$ is at higher redshift and is also slightly shallower, since early X-ray photons begin heating the cold IGM sooner, while $T_\text{CMB}$ is still higher. 

In all cases, when X-ray heating becomes effective, the global brightness temperature rises. Since a higher $\Omega_m$ causes a higher star formation rate at each time, a higher $\Omega_m$ cosmology causes the IGM to be heated more rapidly. Therefore, the trough is narrower (as seen by larger spacing between the curves during falling temperatures, compared to rising temperatures). Similarly, reionization, which is driven by UV radiation from galaxies, begins at different times: in the high $\Omega_m$ cases, the higher density of galaxies at early times ionize the IGM faster, ending the 21-cm signal slightly earlier. On the other hand, lower $\Omega_m$ cases show delayed reionization, shifting the signal beyond that of the simulation domain of \code{21cmSPACE} (later than $z = 6$). Physically, higher matter content should accelerate the buildup of the ionizing background, while lower density postpones it.

The effect of varied $\Omega_m$ on the power spectrum, however, is less simple. The second row of fig. \ref{fig:simulation_results_Om} shows slices of the 21-cm power spectra at specific values of $z$, as a function of $k$. At $z = 40$, little to no star formation has occurred in any cosmology (as can be seen in the lack of deviation between curves in the global signal). The power spectra are thus reflective almost exclusively of the initial conditions themselves, closely resembling the curves in the middle row of fig. \ref{fig:averaged_IC_power_spectra}.
The high $\Omega_m$ cosmologies have significantly higher power on small scales (high $k$) than the low $\Omega_m$ cases, since the higher matter density enables more correlation at these smaller length scales. 

By $z = 20$, however, the impact of various astrophysical processes is far more significant, and the differences between cosmologies are a result of both the deviations in initial conditions and the differences in star formation rates. At this later redshift, all models are in the midst of Cosmic Dawn: the first generations of stars have formed and emitted Ly$\alpha$ and X-rays. This induces patchy heating and coupling, as illustrated by the shallower or even negative gradient of the power spectra on small to mid-length scales ($k \sim 0.1 - 1 ~\text{Mpc}^{-1}$). This patchy heating is a result of halo formation, which occurs at earlier times in higher $\Omega_m$ cosmologies, hence the higher power in high $\Omega_m$ cosmologies compared to low $\Omega_m$ cases. The shapes of the curves also shed light on the length scales of these haloes: in low $\Omega_m$ cases, the power spectrum peaks around $k \sim 0.3 ~\text{Mpc}^{-1}$, indicating heated regions on the scale of a few Mpc; instead, the high $\Omega_m$ cases show high power all the way until $k \gtrsim 1 ~\text{Mpc}^{-1}$, indicating more structure at sub-Mpc scales. 



The last row of fig. \ref{fig:simulation_results_Om} instead shows a perpendicular slice of the 21-cm power spectra, at fixed values of $k$ varying over $z$. Each 21-cm power spectrum exhibits peaks around redshift $z = 20$ and $z = 10$, corresponding most notably to the Cosmic Dawn and the EoR. As is consistent with the 21-cm global signal, varying $\Omega_m$ alters the timing and width of these peaks by changing the process of structure formation. The differences in these power spectra are far larger at large $k$ than at small $k$ (more different at small scales than large scales) which is expected, since both X-ray heating and reionization are results of small scale galactic sources. 
% The fact that power is generally higher at all redshifts for high $\Omega_m$, both for low and high $k$, is also consistent with the power spectra at fixed $z$ (middle row of fig. \ref{fig:simulation_results_Om}).


\subsection{Varying $\Omega_b$}

\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/global_signal_Ob.png}
         \label{fig:global_signal_Ob}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_z_40_Ob.png}
         \label{fig:power_spectrum_fixed_z_40_Ob}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_z_20_Ob.png}
         \label{fig:power_spectrum_fixed_z_20_Ob}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_k_0.1_Ob.png}
         \label{fig:power_spectrum_fixed_k_0.1_Ob}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_k_1_Ob.png}
         \label{fig:power_spectrum_fixed_k_1_Ob}
     \end{subfigure}
        \caption{For custom cosmologies varying the value of $\Omega_b$, the \code{21cmSPACE} simulated 21-cm global signal (top row), the simulated 21-cm matter power spectrum at fixed $z$ (middle row: $z = 40$ on the left and $z = 20$ on the right), and the simulated 21-cm matter power spectrum at fixed $k$ (bottom row: $k = 0.1 ~\text{Mpc}^{-1}$ on the left and $k = 1 ~\text{Mpc}^{-1}$ on the right. The colorbar indicating the value of $\Omega_b$ and legend for Planck 2018 values in the top row apply to all plots.}
        \label{fig:simulation_results_Ob}
\end{figure}

Varying $\Omega_b$ also shifts the timing and amplitude of the absorption trough (the first row of fig. \ref{fig:simulation_results_Ob}), albeit to a lesser degree than the variation of $\Omega_m$. The dependence is also different: whereas increases in both $\Omega_m$ and $\Omega_b$ cause the absorption trough to become deeper, a larger value of $\Omega_m$ causes the absorption trough to reach a minimum earlier, as opposed to an increase $\Omega_b$ causes the trough to shift later in the 21-cm evolution. The fiducial curve using the  Planck 2018 value of $\Omega_b = 0.04897$ lies very close to the $\Omega_b = 0.05$ case, as expected.

The most obvious reason for the increase in depth of the absorption trough can be seen in eq. \ref{eq:brightness_temperature}: differential brightness temperature (i.e., contrast) scales with $\Omega_b$. In addition, the optical depth $\tau_{21}$ in eq. \ref{eq:optical_depth} scales with hydrogen atom number density, which naturally increases with higher $\Omega_b$. This leads to deeper absorption when the gas cools, and stronger emission when the gas heats. Further, increasing baryon density also supplies more fuel for first stars and their X-ray flux, increasing their spin temperature. While this does slightly decrease the optical depth, the aforementioned affects remain dominant, as evident in the top row of fig. \ref{fig:simulation_results_Ob}. The timing of the absorption trough, meanwhile, is shifted later to lower redshift for larger values of $\Omega_b$ since raising $\Omega_b$ while holding $\Omega_m$ constant necessarily reduces the cold dark matter fraction ($\Omega_{dm}$, as in tab. \ref{tab:IC_parameters}). Thus, halos form later with more baryonic pressure, and the onset of Ly$\alpha$ coupling and heating occurs at lower redshift. At the same time, higher baryon density also strengthens collisional coupling at high $z$ , extending the dark-age absorption phase to lower redshifts. 

The second row of fig. \ref{fig:simulation_results_Ob} again shows power spectra at fixed $z$ as functions of $k$, for various values of $\Omega_b$. Again, at $z = 40$, the 21-cm power spectra are generally still reflective of the mass over-density power spectra in fig. \ref{fig:averaged_IC_power_spectra_Ob}. Higher $\Omega_b$ increases the power spectrum amplitude, since $T_b \propto \Omega_b$.  This increase is quite uniform, with only minor changes in shape arising from an increase in $\Omega_b$ increasing the Jeans scale, leading to a small suppression at high $k$. 

The effect of this increase in the Jeans scale is far more pronounced at $z = 20$. At this redshift, when the Universe is partly coupled to the first sources, higher $\Omega_b$ still results generally in suppressed power over all scales. At higher $k$, the increase in Jeans scale suppresses power through pressure. Conversely, because haloes cluster slightly less strongly when dark matter density is reduced, the relative power at small $k$ can rise slightly. Therefore, in addition to power scaling, this shift in power from large $k$ to small $k$ (small length scales to large length scales) results in a "tilting" of the power spectrum.

The physics is further apparent in the bottom row of fig. \ref{fig:simulation_results_Ob}: the delay in star formation induced by higher $\Omega_b$ reducing $\Omega_{dm}$ and hence physically lowering the number of dark matter haloes can clearly be seen, resulting in rightward shifts of the curves toward lower redshift and a reduction in power over both small and large scales. Because of the previously mentioned shift in power from large $k$ to small $k$, the impact of increasing $\Omega_b$ is more pronounced at higher $k$, evidenced by the larger spacing between curves.



\subsection{Varying $h$}

\begin{figure}[H]
     \centering
     \begin{subfigure}[b]{0.9\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/global_signal_h.png}
         \label{fig:global_signal_h}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_z_40_h.png}
         \label{fig:power_spectrum_fixed_z_40_h}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_z_20_h.png}
         \label{fig:power_spectrum_fixed_z_20_h}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_k_0.1_h.png}
         \label{fig:power_spectrum_fixed_k_0.1_h}
     \end{subfigure}
     \hfill
     \begin{subfigure}[b]{0.45\textwidth}
         \centering
         \includegraphics[width=\textwidth]{images/simulation_results/power_spectrum_fixed_k_1_h.png}
         \label{fig:power_spectrum_fixed_k_1_h}
     \end{subfigure}
        \caption{For custom cosmologies varying the value of $h$, the \code{21cmSPACE} simulated 21-cm global signal (top row), the simulated 21-cm matter power spectrum at fixed $z$ (middle row: $z = 40$ on the left and $z = 20$ on the right), and the simulated 21-cm matter power spectrum at fixed $k$ (bottom row: $k = 0.1 ~\text{Mpc}^{-1}$ on the left and $k = 1 ~\text{Mpc}^{-1}$ on the right. The colorbar indicating the value of $h$ and legend for Planck 2018 values in the top row apply to all plots.}
        \label{fig:simulation_results_h}
\end{figure}

Changing $h$ systematically alters the cosmic timeline by altering the relationship between cosmic time and redshift. As well as this, varying the expansion rate of the Universe changes the density of matter, even if the values of $\Omega_m$ and $\Omega_b$ are held constant at the conception of the universe. This imprints itself significantly onto the 21-cm global signal and 21-cm power spectra, as shown in fig. \ref{fig:simulation_results_h}, even if only taken into account through the initial conditions. In the 21-cm global signal, a higher value of $h$ produces a shallower trough earlier in time, since increasing $h$ means that the Universe is younger (and expanding faster) at each given redshift. Hence, there is less time for the gas to cool adiabatically relative to the CMB, and Ly$\alpha$ coupling and X-ray heating happen earlier. As a result, the gas temperature remains higher, the spin temperature is closer to $T_{\text{CMB}}$, and the 21-cm absorption is weaker. Although the differential brightness temperature eq: \ref{eq:brightness_temperature} does scale with $h$, the aforementioned effects are evidently dominant as can be seen in the top row of fig. \ref{fig:simulation_results_h}. 

At $z = 40$ the power spectrum amplitude scales modestly with $h$ (the second row of fig. \ref{fig:simulation_results_h}), reflecting the fact that a larger Hubble constant (with fixed $A_s$) gives a higher matter density and slightly enhanced growth by $z = 40$. Compared to low $k$, the effect of varying $h$ is far more pronounced at high $k$: at these small scales, gas pressure is able to smooth out fluctuations, causing the turnover at $k \sim 1 ~\text{Mpc}^{-1}$. Because higher $h$ cases lead to hotter gas by $z = 40$ due to denser structure, its pressure smoothing scale is larger, causing its spectrum to fall off at slightly smaller $k$. 

At $z = 20$, all curves rise on large scales, then flatten or turn over close to $k \sim 1 ~\text{Mpc}^{-1}$. On large scales ($k \lesssim 0.1 ~\text{Mpc}^{-1}$), the differences are less pronounced, since density contrasts are still linear. However, on small scales, the high $h$ cures are up to an order of magnitude higher than the low $h$ ones, with the difference stemming physically from the non-linear collapse and IGM thermal state. Since higher $h$ has denser early structures and earlier heating, contrast on small scales is boosted. The flattening and dropping of power at highest $k$ scales again reflect pressure smoothing of the gas: since high $h$ models heat earlier, their gas is warmer at $z = 20$, increasing the Jeans scale and causing lower $h$ curves to drop off faster than red curves.

This is consistent with the power spectra at fixed $k$: for both $k = 0.1 ~\text{Mpc}^{-1}$ and $k = 1 ~\text{Mpc}^{-1}$, the earlier heating causes correlations to appear at earlier redshift, since the IGM fluctuations are larger for high $h$. As well as this, the spacing of the curves is more significant in the high $k$ regime, indicating the prominence of the differences in Jeans scale.

\section{Conclusions and Future Work}
\subsection{Conclusions}
The dependence of initial conditions on cosmological parameters has been shown to significantly propagate through evolution during the Dark Ages, Cosmic Dawn, and EoR, imprinting differences on both the 21-cm global signal and 21-cm power spectrum. 

In the case of variation of $\Omega_m$ in cosmologies, the difference primarily manifests as a shifting of timing between astrophysical processes -- higher $\Omega_m$ cosmologies experience clumping earlier than lower $\Omega_m$ cosmologies. This physical difference is illustrated most significantly in shifting in timing of the Cosmic Dawn absorption trough of the 21-cm global signal, with higher $\Omega_m$ cosmologies experiencing earlier Cosmic Dawn, as well as in the 21-cm power spectrum where higher $\Omega_m$ generally exhibits higher power across all scales and redshifts, with earlier correlations at smaller scales.
% \subsection{Project Achievements}
\subsection{Future Work}
The implementation of cosmology dependence on the initial conditions is a major but only first step in the final objective of having variable cosmology as a factor throughout the evolution of the 21-cm signal. Most notably, the halo mass function, which gives the number density of haloes at each mass, is sensitive to cosmological parameters as well. 

Further, the initial conditions inherently rely on randomness in their instantiation, through the assumption that the initial fluctuations are a Gaussian random field \citep{Guth_Pi_1982, Brandenberger_1985}. This randomness propagates into the 21-cm power spectrum; therefore, the 21-cm evolution should be performed using various initial condition boxes with different Gaussian random draws, in order to gain clear insight into the statistical effects of the cosmologies without the distortions of randomness.



\begin{acknowledgments}
The author thanks Prof. Anastasia Fialkov and Jiten Dhandha for thorough supervision and helpful guidance throughout the project duration. 

Work done in this project also relied heavily on previously-written, public Python packages including \code{NumPy}, \code{SciPy}, \code{Astropy}, \code{matplotlib}. As well as this, numerous closed-source codes were used, including \code{21cmSPACE}, \code{py21cmSPACE}, and \code{get\_power\_spectrum\_1d}. Some executions of these codes were performed on Cambridge University's CSD3 high performance computing cluster.

Finally, programming, research, and writing were significantly accelerated by generative AI tools, most notably Microsoft's Copilot and OpenAI's ChatGPT. 
\end{acknowledgments}

% \newpage
% \nocite{*}
% \printbibliography[title={References}]

% \addcontentsline{toc}{section}{References}
% \nocite{*}
\bibliography{references}

% \begin{appendices}
% \section{Global signal extrema}
% \begin{table}[H]
%     \centering
%     \begin{tabular}{c c c c}
%         \hline
%         Cosmology name & beginning of cosmic dawn & beginning of heating & beginning of reionization \\ 
%         \hhline{= = = =}
%         Planck18 & (30, -5.5) & (18, -141.7) & (9, 11.6) \\ \hline
%         Om1 & (29, -4.2) & (16, -143.4) & (8, 11.4) \\
%         Om2 & (29, -4.8) & (17, -142.8) & (9, 10.5) \\
%         Om3 & (30, -5.5) & (18, -141.6) & (9, 11.6) \\
%         Om4 & (31, -6.2) & (18, -141.4) & (10, 11.9) \\
%         Om5 & (32, -7.0) & (19, -141.7) & (11, 12.9) \\ \hline
%         Ob3 & (31, -5.9) & (18, -142.7) & (10, 11.6) \\
%         Ob4 & (31, -5.7) & (18, -142.7) & (10, 11.3) \\
%         Ob5 & (30, -5.5) & (18, -141.9) & (10, 10.8) \\
%         Ob6 & (30, -5.3) & (17, -142.1) & (9, 10.7) \\
%         Ob7 & (30, -5.2) & (17, -143.0) & (9, 10.6) \\ \hline
%         h5 & (29, -4.8) & (17, -143.1) & (9, 11.4) \\
%         h6 & (30, -5.2) & (17, -142.7) & (9, 10.7) \\
%         h7 & (31, -5.6) & (18, -142.5) & (10, 11.1) \\
%         h8 & (31, -6.0) & (18, -142.5) & (10, 11.7) \\
%         h9 & (31, -6.5) & (19, -142.0) & (10, 12.0) \\ \hline
%     \end{tabular}
%     \caption{(redshift, temperature) pairs of the extrema present in the 21-cm global signal for each cosmology. The column are ordered chronologically (largest to smallest redshift), and the column headers indicate the physical change behind each extremum.}
%     \label{tab:global_signal_extrema}
% \end{table}

% \end{appendices}



\end{document}